# 电解铝负荷数据生成说明

本文件夹包含了为电解铝负荷生成历史训练数据的脚本，用于支持基于逆优化的数据驱动降维方法。

## 文件说明

### 核心脚本
- `data_generate_eal.m` - 主要的数据生成脚本
- `data_price.m` - 电价数据读取脚本（支持缓存）
- `exchange_rate_config.m` - 汇率配置脚本
- `test_exchange_rate.m` - 汇率转换测试脚本

### 修改的文件
- `initialize_parameters.m` - 修改为支持外部电价输入
- `cell_linear_optimization_24h.m` - 电解铝优化模型（无需修改）

## 使用方法

### 1. 配置汇率（可选）
设置美元到人民币的汇率：
```matlab
cd Data-Driven-Dimension-Reduction/data_set/EAL_Implementation/
exchange_rate_config
```

测试汇率转换功能：
```matlab
test_exchange_rate
```

### 2. 生成完整数据集
运行完整的数据生成：
```matlab
data_generate_eal
```

### 3. 使用生成的数据
生成的数据将保存为 `dataset_eal.mat`，包含：
- `E_primal_days_train` - 训练集用电数据 (24×21)
- `Price_days_train` - 训练集电价数据 (24×21)
- `E_primal_days_cv` - 验证集用电数据 (24×10)
- `Price_days_cv` - 验证集电价数据 (24×10)

## 数据来源

### 电价数据
- 来源：PJM电力市场2022年7月实时电价数据
- 文件：`../STN_Implementation/rt_hrl_lmps.xlsx`
- 格式：31天×24小时的电价数据
- 单位转换：从美元转换为人民币（汇率：1美元=7.2人民币）
- 缓存：首次读取后自动缓存为`price_data_cache.mat`，避免重复读取Excel文件

### 用电数据
- 来源：电解铝优化模型在给定电价下的最优解
- 模型：`cell_linear_optimization_24h.m`
- 格式：每小时的功率消耗（MW）

## 数据生成流程

1. **读取电价数据**：从PJM市场数据中读取31天的电价
2. **逐日优化**：对每一天，使用当天电价求解电解铝优化模型
3. **提取结果**：从优化结果中提取最优功率方案
4. **数据分割**：前21天作为训练集，后10天作为验证集
5. **保存数据**：以与STN/RTN相同的格式保存数据

## 关键特性

### 电价响应
电解铝模型会根据电价变化调整：
- 高电价时段：降低电流，减少功率消耗
- 低电价时段：提高电流，增加功率消耗
- 保持工艺约束：温度、浓度、厚度等约束

### 数据质量
- 所有数据都来自优化模型的最优解
- 确保满足所有工艺约束
- 反映真实的电价响应行为

## 注意事项

1. **求解器要求**：需要安装Gurobi求解器
2. **计算时间**：完整生成31天数据需要较长时间
3. **内存使用**：确保有足够内存运行优化模型
4. **数据一致性**：使用与STN/RTN相同的电价数据确保一致性
5. **缓存机制**：电价数据会自动缓存，提高后续运行效率

## 故障排除

### 常见问题
1. **求解失败**：检查Gurobi许可证和模型参数
2. **电价文件找不到**：确保`rt_hrl_lmps.xlsx`文件存在
3. **内存不足**：减少同时处理的天数
4. **缓存问题**：如需重新读取Excel数据，运行`clear_price_cache.m`

### 调试建议
1. 先运行测试脚本验证基本功能
2. 检查单日优化是否成功
3. 逐步增加处理的天数

## 扩展使用

生成的数据可以直接用于：
1. **ALF模型训练**：使用`model_training.m`训练简化模型
2. **模型验证**：使用`test_reduced_constraints_ALF.m`验证模型性能
3. **对比分析**：与STN/RTN数据进行对比分析

## 联系信息

如有问题，请参考主项目的README文件或联系开发团队。
